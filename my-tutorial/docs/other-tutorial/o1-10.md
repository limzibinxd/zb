---
title: "1️⃣🅾️ Self-Hosted GitLab with Docker: A Complete Guide"
sidebar_position: 10
---

This guide covers setting up a GitLab server, a CI/CD runner, and GitLab Pages on a local network using Docker.

### 📝 Prerequisites

* A server or Virtual Machine (VM) with a **static private IP address** (e.g., `192.168.2.190`).
* **Docker** and **Docker Compose** installed on the VM.
* Chosen **hostnames** for your services (we will use `uchi-gitlab` and `uchi-pages`).

---

## Part 1: GitLab Server Setup 🚀

This section covers the main GitLab instance. All commands are run on your VM.

### 1. Create the `docker-compose.yml` File

In the **Gitlab VM**, create a directory for your GitLab setup with a `docker-compose.yml` file inside it.

```yaml
version: '3.7'
services:
  gitlab:
    image: 'gitlab/gitlab-ce:latest'
    restart: always
    hostname: 'uchi-gitlab'
    environment:
      GITLAB_OMNIBUS_CONFIG: |
        # Use your custom local hostnames
        external_url 'http://uchi-gitlab'
        pages_external_url "http://uchi-pages"

        # GitLab Pages Configuration
        gitlab_pages['enable'] = true
        gitlab_pages['access_control'] = true
        gitlab_pages['inplace_chroot'] = true
    ports:
      - '80:80'
      - '2222:22'
    volumes:
      - './config:/etc/gitlab'
      - './logs:/var/log/gitlab'
      - './data:/var/opt/gitlab'
    shm_size: '256m'

  gitlab-runner:
    image: 'gitlab/gitlab-runner:latest'
    restart: always
    volumes:
      - './runner-config:/etc/gitlab-runner'
      - '/var/run/docker.sock:/var/run/docker.sock'
```
### 2. Edit Local Host File

On your **personal computer** (and any other computer that needs to access GitLab), you must edit the hosts file to point your chosen hostnames to the server's IP.

* Windows: C:\Windows\System32\drivers\etc\hosts
* macOS / Linux: /etc/hosts

Add the following lines, replacing the IP with your server's IP:
```
192.168.2.190	uchi-gitlab
192.168.2.190	uchi-pages           # Main Pages Domain
192.168.2.190   root.uchi-pages      # Example for 'root' user
192.168.2.190   projects.uchi-pages  # Pages Authentication
```
:::info 
GitLab Pages uses several subdomains. You must add all of them to the hosts file on every computer that needs access.  
:::

### 3. Start the Gitlab Server
Navigate to your GitLab directory in the terminal and run:
```bash
docker-compose up -d
```
:::info
`docker-compose up`: This is the main instruction. It tells Docker to create and start all the containers, networks, and volumes defined in your docker-compose.yml file. If the containers already exist, it will recreate them only if their configuration or image has changed.  

`-d`: This flag stands for detached mode. It means that once the containers start, your terminal is freed up, and the containers will continue running in the background. Without this flag, your terminal would be attached to the containers' logs, and closing the terminal would stop them.  
:::

Your GitLab instance will be available at http://uchi-gitlab after a few minutes.

## Part 2: GitLab Runner Setup

This sets up a CI/CD runner using the Docker Executor, which is the most flexible method.

```yaml
# (Keep the 'gitlab' service from above)
  gitlab-runner:
    image: 'gitlab/gitlab-runner:latest'
    restart: always
    volumes:
      - './runner-config:/etc/gitlab-runner'
      - '/var/run/docker.sock:/var/run/docker.sock'
```

The volume /var/run/docker.sock is critical. It allows the runner to start other Docker containers to run your jobs.

### 2. Register the Runner

1. Get the Registration Token: In GitLab, go to Admin Area > CI/CD > Runners and copy the token.

2. Run the Registration Command:
```bash
docker-compose run --rm gitlab-runner register
```
3. Answer the Prompts:

    * GitLab instance URL: http://uchi-gitlab

    * Registration token: [PASTE_YOUR_TOKEN]

    * Description: My Docker Runner

    * Tags: docker,linux

    * Executor: docker

    * Default Docker image: node:20-alpine (A good default for web projects)

### 3. Start the Full Stack
Run the command to start both GitLab and the new runner.
```bash
docker-compose up -d
```

## Part 4: Example **.gitlab-ci.yml** for a Web Project
This is a sample CI/CD file for a Docusaurus or other Node.js-based static site. Place it in the root of your repository.
```yaml
# Caching node_modules is a great way to speed up future pipelines.
cache:
  paths:
    - node_modules/

# The 'pages' job is required for GitLab Pages deployment.
pages:
  stage: deploy

  # This tag must match your shell runner.
  tags:
    - shell

  script:
    - echo "Installing dependencies..."
    - yarn install

    - echo "Building Docusaurus site..."
    # 1. The standard command to build a Docusaurus site.
    - yarn build

    - echo "Preparing files for GitLab Pages..."
    # 2. Rename the 'build' output folder to 'public'.
    - mv build public

  artifacts:
    # This tells GitLab to take the 'public' directory and serve it as your website.
    paths:
      - public

  # This ensures the site only deploys when you push to the 'main' branch.
  only:
    - main
```