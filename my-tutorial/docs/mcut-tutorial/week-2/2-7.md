---
title: 2-6 Create Yocto Layer & Recipe
sidebar_position: 7
---

# 2-6 Create Yocto Layer & Recipe

A **Yocto Layer** is like a collection of ingredients or a bundle of features that you can add to your system. It contains software, configurations, and settings that help build a custom operating system. Layers make it easier to organize and reuse code.

A **Yocto Recipe** is like a recipe card that tells Yocto how to build a specific piece of software. It contains instructions on where to find the code, how to compile it, and how to install it. Think of it as the step-by-step guide for creating software in the Yocto system.

In this tutorial, we will add a simple Hello World program into the Yocto Project as part of the Linux image. Then, we will execute the program on our target board Renesas RZ/G2L.

---

## Step 1: Create a New Layer
Go to `home/rzg2l/yocto` directory, create a layer named `meta-test` using the command below

```bash
source poky/oe-init-build-env
```

```bash
bitbake-layers create-layer meta-test
```

A folder named `meta-test` is created, the structure is 

```
.
├── conf
│   └── layer.conf
├── COPYING.MIT
├── README
└── recipes-example
    └── example
        └── example_0.1.bb
```

## Step 2: Add a "Hello World" Program
To add your own program, create a folder named according to your preference in `~/meta-test/recipes-example`. In this case, we will name our folder `hello` and add a simple Hello World program. The structure should be like:

```bash
hello
├── files
│   └── hello.c
└── hello.bb
```

Paste the program into
```c title="hello.c"
# include <stdio.h>

int main(void) {
   printf("Hello, World!\n");
   return 0;
}
```

```bb title="hello.bb"
DESCRIPTION = "Simple Hello World application"

LICENSE = "MIT"

LIC_FILES_CHKSUM = "file://${COREBASE}/meta/COPYING.MIT;md5=3da9cfbcb788c80a0384361b4de20420"

SRC_URI = "file://hello.c"

S = "${WORKDIR}/build"

do_compile() {
    ${CC} ${CFLAGS} ${LDFLAGS} ${WORKDIR}/hello.c -o ${S}/hello
}

do_install() {
    install -d ${D}${bindir}
    install -m 0755 ${S}/hello ${D}${bindir}/
}
```

## Step 3: Edit `bblayers.conf` and `local.conf` files

Add the `meta-test` folder under `BBLAYERS ?=`:

```conf title="bblayers.conf"
BBLAYERS ?= " \
  ${TOPDIR}/../meta-gplv2 \
  ...
  ${TOPDIR}/../meta-test \
  ...
```

Next, add the name of the recipe to `local.conf` by adding the line below:

```conf title="local.conf"
IMAGE_INSTALL:append = " hello "
```

## Step 4: Rebuild Image
Now, we can rebuild the image with our own program added to the build.

Firstly, initialize the build in the `/workspaces/rzg/yocto` directory.

```bash
source poky/oe-init-build-env build
```

Run the following command to start building the image.

```bash
MACHINE=smarc-rzg2l bitbake core-image-qt
```

:::tip
If you have previously built the qt image, the process usually only takes a few minutes to finish. This is because the cached files are reused and only our program needs to be compiled from scratch.
:::

## Step 5: Test the Program

In your serial monitor, type in the name of the program and hit `Enter`.

:::note
Follow the previous guide to learn how to flash an image to SD card and boot up from it. 
:::

When you type `hello`, it will show `Hello, world!`

![hello world](./img/2-6-4.png)

## References

- [How to Build a Hello World Recipe](https://www.wpgdadatong.com/blog/detail/42091)

- [Yocto Tutorial - 08 Creating a Simple Hello World Yocto Recipe](https://www.youtube.com/watch?v=YSITCPhk_qU)

---